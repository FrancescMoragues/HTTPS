BORRAR TODO EN CASO DE NECESITAR REINSTALAR

sudo systemctl stop apache2
sudo apt purge apache2* -y
sudo apt autoremove -y
sudo rm -rf /var/www/appintranet /var/www/appsistema /srv/www/appintranet /srv/www/appsistema /etc/apache2/ssl

COMPROBAR QUE FUNCIONA

1) Estado del servicio: Ejecuta systemctl status apache2 para asegurarte de que está activo y sin errores tras el reinicio.

Comprobación del puerto: Utiliza ss -tuln | grep :443 para verificar que el puerto 443 aparece en estado LISTEN, tal como se veía en tus capturas previas.

2) Ejecuta: openssl x509 -in /etc/apache2/ssl/apache.crt -text -noout | grep "Subject".

Resultado esperado: Deberías ver CN = www.intranet.kuy.com. Si sigue apareciendo "primernomdedomini", el certificado no se generó correctamente con las nuevas variables.

3) Acceso al Directorio Privado: Entra desde un navegador a https://www.intranet.kuy.com/privado.

Resultado esperado: El sistema debe pedirte usuario y contraseña. Prueba con Usuari01 y la contraseña 1234 definida en el script.

Restricción de IP: Si intentas acceder desde una IP que no sea de la red 10.18.70.0/24 (ip de ejemplo), el servidor debería denegar el acceso (Error 403).

4) Ejecución de Scripts: Accede a https://www.sistema.kuy.org/uptime.sh. Si el módulo CGI y los permisos están bien, verás el tiempo de actividad del servidor en el navegador.

Prueba de Error 404: Intenta entrar en una URL que no exista (ej. https://www.intranet.kuy.com/noexiste).

Resultado esperado: Debe aparecer el mensaje exacto: "Error en la aplicacion web appintranet - archivo no encontrado".

5) Finalmente, verifica que los logs se están generando en las rutas solicitadas por la tabla:

Mira el archivo de errores: tail -f /var/www/appintranet/logs/error.log

IMPORTANTÍSIMO

SERVIDOR

Una vez descargado todo, entra en sudo nano /etc/apache2/sites-available/appintranet-ssl.conf
                                            /etc/apache2/sites-available/appintranet-ssl.conf
Cambia esto

<Directory /srv/www/appintranet/privado>
    AuthType Basic
    AuthName "Acces Restringit Intranet"
    AuthUserFile /etc/apache2/.htpasswd_intra
    
    # Esto obliga a que se cumplan AMBAS condiciones:
    <RequireAll>
        Require valid-user
        Require ip 192.168.3.0/24
    </RequireAll>
</Directory>

CLIENTE LINUX

Abre la terminal del cliente linux y escribe: sudo nano /etc/hosts.

Añade esta línea al final: 192.168.3.78 (ip del servidor) www.intranet.kuy.com www.sistema.kuy.org.

Guarda (Ctrl+O, Enter) y sal (Ctrl+X).

Abre el archivo: C:\Windows\System32\drivers\etc\hosts.

Añade al final: 192.168.3.78 www.intranet.kuy.com.

1. Para cumplir con la Segunda Parte de tu guía, he preparado un script robusto que automatiza la instalación de Apache, la generación del certificado autofirmado y la configuración del VirtualHost seguro.

Este script asume que estás configurando el servidor de la "Intranet". He utilizado valores genéricos basados en tu guía que deberías ajustar según lo que hayas definido en la "Passa 1".

Notas importantes para tu documentación (Wiki)

2. Para completar la Passa 3 (Comprobación) y la Passa 4 (Documentación), ten en cuenta lo siguiente:

Resolución de Nombres: Como es un entorno de intranet y el dominio intranet.primernomdedomini.com probablemente no existe en internet, debes añadir la IP del servidor al archivo /etc/hosts de tu máquina cliente:

Ejemplo: 192.168.1.50 intranet.primernomdedomini.com

Advertencia del Navegador: Al ser un certificado autofirmado, el navegador mostrará un aviso de "Conexión no privada". Es normal; para el ejercicio, simplemente debes aceptar el riesgo y continuar.

Firewall: Si tienes ufw activado, recuerda permitir el tráfico HTTPS:

sudo ufw allow 'Apache Full'

3. Variables Críticas (Lo que cambia seguro)
En cualquier script o configuración manual, tendrás que localizar y sustituir estos tres bloques:

Identidad del Servidor:

ServerName: El dominio principal (ej: www.examen.com).

ServerAlias: Otros nombres (ej: examen.com o www2.examen.com).

ServerAdmin: El correo que te pida el profesor.

Rutas de Archivos:

DocumentRoot: La carpeta donde están los .html. Asegúrate de que la ruta sea exactamente la que pida el enunciado (ej: /var/www/html/web1).

Red y Seguridad:

Require ip: Cambia la IP de red (ej: 192.168.10.0/24) por la de la VLAN que te asignen.

SSLCertificateFile: Si es HTTPS, asegúrate de que la ruta apunte al archivo .crt que generes.

2. Checklist para HTTPS (Certificados)
Si el profesor te pide cambiar los datos del certificado (País, Organización, etc.), el comando clave es el openssl. Fíjate en el parámetro -subj:

Bash
# Ejemplo de lo que deberías editar:
-subj "/C=ES/ST=Valencia/L=Alzira/O=Instituto/CN=intranet.tu-dominio.com"
C: País (2 letras).

ST: Provincia/Estado.

CN (Common Name): ¡Ojo aquí! Debe ser el dominio exacto (ej: intranet.ejemplo.com). Si esto no coincide, el navegador dará error crítico.
